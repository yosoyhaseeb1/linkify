var pt=e=>{throw TypeError(e)};var Y=(e,t,s)=>t.has(e)||pt("Cannot "+s);var r=(e,t,s)=>(Y(e,t,"read from private field"),s?s.call(e):t.get(e)),b=(e,t,s)=>t.has(e)?pt("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,s),l=(e,t,s,i)=>(Y(e,t,"write to private field"),i?i.call(e,s):t.set(e,s),s),f=(e,t,s)=>(Y(e,t,"access private method"),s);import{s as xt,t as gt,v as E,w as Z,x as j,y as q,z as tt,B as bt,D as _t,E as V,F as Mt,G as Qt,H as Rt,I as Et,r as O,J as Ct,K as Pt,p as Ut,b as Ft,l as Dt,u as wt,a as kt}from"./index-EQAU33AY.js";var y,o,$,R,Q,D,I,x,z,k,A,P,U,_,L,c,N,et,st,rt,it,nt,at,ot,It,St,At=(St=class extends xt{constructor(t,s){super();b(this,c);b(this,y);b(this,o);b(this,$);b(this,R);b(this,Q);b(this,D);b(this,I);b(this,x);b(this,z);b(this,k);b(this,A);b(this,P);b(this,U);b(this,_);b(this,L,new Set);this.options=s,l(this,y,t),l(this,x,null),l(this,I,gt()),this.bindMethods(),this.setOptions(s)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(r(this,o).addObserver(this),yt(r(this,o),this.options)?f(this,c,N).call(this):this.updateResult(),f(this,c,it).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return ht(r(this,o),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return ht(r(this,o),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,f(this,c,nt).call(this),f(this,c,at).call(this),r(this,o).removeObserver(this)}setOptions(t){const s=this.options,i=r(this,o);if(this.options=r(this,y).defaultQueryOptions(t),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof E(this.options.enabled,r(this,o))!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");f(this,c,ot).call(this),r(this,o).setOptions(this.options),s._defaulted&&!Z(this.options,s)&&r(this,y).getQueryCache().notify({type:"observerOptionsUpdated",query:r(this,o),observer:this});const a=this.hasListeners();a&&vt(r(this,o),i,this.options,s)&&f(this,c,N).call(this),this.updateResult(),a&&(r(this,o)!==i||E(this.options.enabled,r(this,o))!==E(s.enabled,r(this,o))||j(this.options.staleTime,r(this,o))!==j(s.staleTime,r(this,o)))&&f(this,c,et).call(this);const n=f(this,c,st).call(this);a&&(r(this,o)!==i||E(this.options.enabled,r(this,o))!==E(s.enabled,r(this,o))||n!==r(this,_))&&f(this,c,rt).call(this,n)}getOptimisticResult(t){const s=r(this,y).getQueryCache().build(r(this,y),t),i=this.createResult(s,t);return Bt(this,i)&&(l(this,R,i),l(this,D,this.options),l(this,Q,r(this,o).state)),i}getCurrentResult(){return r(this,R)}trackResult(t,s){return new Proxy(t,{get:(i,a)=>(this.trackProp(a),s==null||s(a),a==="promise"&&(this.trackProp("data"),!this.options.experimental_prefetchInRender&&r(this,I).status==="pending"&&r(this,I).reject(new Error("experimental_prefetchInRender feature flag is not enabled"))),Reflect.get(i,a))})}trackProp(t){r(this,L).add(t)}getCurrentQuery(){return r(this,o)}refetch({...t}={}){return this.fetch({...t})}fetchOptimistic(t){const s=r(this,y).defaultQueryOptions(t),i=r(this,y).getQueryCache().build(r(this,y),s);return i.fetch().then(()=>this.createResult(i,s))}fetch(t){return f(this,c,N).call(this,{...t,cancelRefetch:t.cancelRefetch??!0}).then(()=>(this.updateResult(),r(this,R)))}createResult(t,s){var ft;const i=r(this,o),a=this.options,n=r(this,R),h=r(this,Q),d=r(this,D),g=t!==i?t.state:r(this,$),{state:m}=t;let u={...m},C=!1,p;if(s._optimisticResults){const S=this.hasListeners(),K=!S&&yt(t,s),F=S&&vt(t,i,s,a);(K||F)&&(u={...u,...Qt(m.data,t.options)}),s._optimisticResults==="isRestoring"&&(u.fetchStatus="idle")}let{error:M,errorUpdatedAt:B,status:v}=u;p=u.data;let H=!1;if(s.placeholderData!==void 0&&p===void 0&&v==="pending"){let S;n!=null&&n.isPlaceholderData&&s.placeholderData===(d==null?void 0:d.placeholderData)?(S=n.data,H=!0):S=typeof s.placeholderData=="function"?s.placeholderData((ft=r(this,A))==null?void 0:ft.state.data,r(this,A)):s.placeholderData,S!==void 0&&(v="success",p=Rt(n==null?void 0:n.data,S,s),C=!0)}if(s.select&&p!==void 0&&!H)if(n&&p===(h==null?void 0:h.data)&&s.select===r(this,z))p=r(this,k);else try{l(this,z,s.select),p=s.select(p),p=Rt(n==null?void 0:n.data,p,s),l(this,k,p),l(this,x,null)}catch(S){l(this,x,S)}r(this,x)&&(M=r(this,x),p=r(this,k),B=Date.now(),v="error");const W=u.fetchStatus==="fetching",J=v==="pending",X=v==="error",lt=J&&W,dt=p!==void 0,w={status:v,fetchStatus:u.fetchStatus,isPending:J,isSuccess:v==="success",isError:X,isInitialLoading:lt,isLoading:lt,data:p,dataUpdatedAt:u.dataUpdatedAt,error:M,errorUpdatedAt:B,failureCount:u.fetchFailureCount,failureReason:u.fetchFailureReason,errorUpdateCount:u.errorUpdateCount,isFetched:u.dataUpdateCount>0||u.errorUpdateCount>0,isFetchedAfterMount:u.dataUpdateCount>g.dataUpdateCount||u.errorUpdateCount>g.errorUpdateCount,isFetching:W,isRefetching:W&&!J,isLoadingError:X&&!dt,isPaused:u.fetchStatus==="paused",isPlaceholderData:C,isRefetchError:X&&dt,isStale:ct(t,s),refetch:this.refetch,promise:r(this,I),isEnabled:E(s.enabled,t)!==!1};if(this.options.experimental_prefetchInRender){const S=G=>{w.status==="error"?G.reject(w.error):w.data!==void 0&&G.resolve(w.data)},K=()=>{const G=l(this,I,w.promise=gt());S(G)},F=r(this,I);switch(F.status){case"pending":t.queryHash===i.queryHash&&S(F);break;case"fulfilled":(w.status==="error"||w.data!==F.value)&&K();break;case"rejected":(w.status!=="error"||w.error!==F.reason)&&K();break}}return w}updateResult(){const t=r(this,R),s=this.createResult(r(this,o),this.options);if(l(this,Q,r(this,o).state),l(this,D,this.options),r(this,Q).data!==void 0&&l(this,A,r(this,o)),Z(s,t))return;l(this,R,s);const i=()=>{if(!t)return!0;const{notifyOnChangeProps:a}=this.options,n=typeof a=="function"?a():a;if(n==="all"||!n&&!r(this,L).size)return!0;const h=new Set(n??r(this,L));return this.options.throwOnError&&h.add("error"),Object.keys(r(this,R)).some(d=>{const T=d;return r(this,R)[T]!==t[T]&&h.has(T)})};f(this,c,It).call(this,{listeners:i()})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&f(this,c,it).call(this)}},y=new WeakMap,o=new WeakMap,$=new WeakMap,R=new WeakMap,Q=new WeakMap,D=new WeakMap,I=new WeakMap,x=new WeakMap,z=new WeakMap,k=new WeakMap,A=new WeakMap,P=new WeakMap,U=new WeakMap,_=new WeakMap,L=new WeakMap,c=new WeakSet,N=function(t){f(this,c,ot).call(this);let s=r(this,o).fetch(this.options,t);return t!=null&&t.throwOnError||(s=s.catch(q)),s},et=function(){f(this,c,nt).call(this);const t=j(this.options.staleTime,r(this,o));if(tt||r(this,R).isStale||!bt(t))return;const i=_t(r(this,R).dataUpdatedAt,t)+1;l(this,P,V.setTimeout(()=>{r(this,R).isStale||this.updateResult()},i))},st=function(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(r(this,o)):this.options.refetchInterval)??!1},rt=function(t){f(this,c,at).call(this),l(this,_,t),!(tt||E(this.options.enabled,r(this,o))===!1||!bt(r(this,_))||r(this,_)===0)&&l(this,U,V.setInterval(()=>{(this.options.refetchIntervalInBackground||Mt.isFocused())&&f(this,c,N).call(this)},r(this,_)))},it=function(){f(this,c,et).call(this),f(this,c,rt).call(this,f(this,c,st).call(this))},nt=function(){r(this,P)&&(V.clearTimeout(r(this,P)),l(this,P,void 0))},at=function(){r(this,U)&&(V.clearInterval(r(this,U)),l(this,U,void 0))},ot=function(){const t=r(this,y).getQueryCache().build(r(this,y),this.options);if(t===r(this,o))return;const s=r(this,o);l(this,o,t),l(this,$,t.state),this.hasListeners()&&(s==null||s.removeObserver(this),t.addObserver(this))},It=function(t){Et.batch(()=>{t.listeners&&this.listeners.forEach(s=>{s(r(this,R))}),r(this,y).getQueryCache().notify({query:r(this,o),type:"observerResultsUpdated"})})},St);function Lt(e,t){return E(t.enabled,e)!==!1&&e.state.data===void 0&&!(e.state.status==="error"&&t.retryOnMount===!1)}function yt(e,t){return Lt(e,t)||e.state.data!==void 0&&ht(e,t,t.refetchOnMount)}function ht(e,t,s){if(E(t.enabled,e)!==!1&&j(t.staleTime,e)!=="static"){const i=typeof s=="function"?s(e):s;return i==="always"||i!==!1&&ct(e,t)}return!1}function vt(e,t,s,i){return(e!==t||E(i.enabled,e)===!1)&&(!s.suspense||e.state.status!=="error")&&ct(e,s)}function ct(e,t){return E(t.enabled,e)!==!1&&e.isStaleByTime(j(t.staleTime,e))}function Bt(e,t){return!Z(e.getCurrentResult(),t)}var Ot=O.createContext(!1),Nt=()=>O.useContext(Ot);Ot.Provider;function jt(){let e=!1;return{clearReset:()=>{e=!1},reset:()=>{e=!0},isReset:()=>e}}var $t=O.createContext(jt()),zt=()=>O.useContext($t),Ht=(e,t,s)=>{const i=s!=null&&s.state.error&&typeof e.throwOnError=="function"?Ct(e.throwOnError,[s.state.error,s]):e.throwOnError;(e.suspense||e.experimental_prefetchInRender||i)&&(t.isReset()||(e.retryOnMount=!1))},Kt=e=>{O.useEffect(()=>{e.clearReset()},[e])},Gt=({result:e,errorResetBoundary:t,throwOnError:s,query:i,suspense:a})=>e.isError&&!t.isReset()&&!e.isFetching&&i&&(a&&e.data===void 0||Ct(s,[e.error,i])),Vt=e=>{if(e.suspense){const s=a=>a==="static"?a:Math.max(a??1e3,1e3),i=e.staleTime;e.staleTime=typeof i=="function"?(...a)=>s(i(...a)):s(i),typeof e.gcTime=="number"&&(e.gcTime=Math.max(e.gcTime,1e3))}},Wt=(e,t)=>e.isLoading&&e.isFetching&&!t,Jt=(e,t)=>(e==null?void 0:e.suspense)&&t.isPending,mt=(e,t,s)=>t.fetchOptimistic(e).catch(()=>{s.clearReset()});function Xt(e,t,s){var C,p,M,B;const i=Nt(),a=zt(),n=Pt(),h=n.defaultQueryOptions(e);(p=(C=n.getDefaultOptions().queries)==null?void 0:C._experimental_beforeQuery)==null||p.call(C,h);const d=n.getQueryCache().get(h.queryHash);h._optimisticResults=i?"isRestoring":"optimistic",Vt(h),Ht(h,a,d),Kt(a);const T=!n.getQueryCache().get(h.queryHash),[g]=O.useState(()=>new t(n,h)),m=g.getOptimisticResult(h),u=!i&&e.subscribed!==!1;if(O.useSyncExternalStore(O.useCallback(v=>{const H=u?g.subscribe(Et.batchCalls(v)):q;return g.updateResult(),H},[g,u]),()=>g.getCurrentResult(),()=>g.getCurrentResult()),O.useEffect(()=>{g.setOptions(h)},[h,g]),Jt(h,m))throw mt(h,g,a);if(Gt({result:m,errorResetBoundary:a,throwOnError:h.throwOnError,query:d,suspense:h.suspense}))throw m.error;if((B=(M=n.getDefaultOptions().queries)==null?void 0:M._experimental_afterQuery)==null||B.call(M,h,m),h.experimental_prefetchInRender&&!tt&&Wt(m,i)){const v=T?mt(h,g,a):d==null?void 0:d.promise;v==null||v.catch(q).finally(()=>{g.updateResult()})}return h.notifyOnChangeProps?m:g.trackResult(m)}function Tt(e,t){return Xt(e,At)}const Yt=`https://${Ut}.supabase.co/functions/v1/make-server-0d5eb2a5`;async function Zt(e,t,s){const i=await s();if(!i)throw new Error("Authentication required - no valid token available");const a=`${Yt}${e}`,n=await fetch(a,{...t,headers:{Authorization:`Bearer ${Ft}`,"x-clerk-token":i,"Content-Type":"application/json",...t.headers}});if(!n.ok){const d=await n.text();throw Dt.error(`API error on ${e}:`,d),new Error(`API request failed: ${n.status} ${n.statusText}`)}const h=n.headers.get("content-type");return h&&h.includes("application/json")?await n.json():null}async function ut(e,t){return Zt(e,{method:"GET"},t)}async function qt(e,t=1,s=20){const a=(await ut("/runs",e)).runs||[],n=(t-1)*s,h=n+s;return{runs:a.slice(n,h),totalCount:a.length}}async function te(e,t){return ut(`/runs/${e}`,t)}async function ne(e){return(await ee(e)).prospects||[]}async function ee(e){return ut("/pipeline",e)}function ae(e={}){const{page:t=1,pageSize:s=20,status:i}=e,{getToken:a}=wt(),{currentOrg:n}=kt(),h=n==null?void 0:n.id,{data:d,isLoading:T,error:g,refetch:m}=Tt({queryKey:["runs",h,{page:t,pageSize:s,status:i}],queryFn:async()=>{const u=await qt(a,t,s);if(i&&u.runs){const C=u.runs.filter(p=>p.status===i);return{runs:C,totalCount:C.length}}return u},enabled:!!h});return{runs:(d==null?void 0:d.runs)||[],isLoading:T,error:g,refetch:m,totalCount:(d==null?void 0:d.totalCount)||0}}function oe(e){const{getToken:t}=wt(),{data:s,isLoading:i,error:a}=Tt({queryKey:["run",e],queryFn:async()=>{if(!e)throw new Error("Run ID is required");return await te(e,t)},enabled:!!e});return{run:s,isLoading:i,error:a}}export{ae as a,oe as b,ne as g,Tt as u};
