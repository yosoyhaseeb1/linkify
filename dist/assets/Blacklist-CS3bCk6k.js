import{k as D,a as U,u as I,r as c,p,b as h,o,j as e,n as P,S as N}from"./index-EQAU33AY.js";import{D as M}from"./download-CatP__KJ.js";import{U as G,T as J}from"./upload-n3QMHuFw.js";import{P as W}from"./plus-CsoShjA1.js";import{T as H}from"./trash-2-DNzLU7cH.js";function Z(){const w=D(),{currentOrg:a}=U(),{getToken:m}=I(),u=c.useRef(null),[C,f]=c.useState(!0),[b,S]=c.useState([]),[E,g]=c.useState(!1),[r,d]=c.useState({company:"",domain:"",reason:""});c.useEffect(()=>{x()},[a]);const x=async()=>{if(a)try{f(!0);const t=await m();if(!t){console.error("Failed to get authentication token for loading blacklist"),f(!1);return}const s=await fetch(`https://${p}.supabase.co/functions/v1/make-server-0d5eb2a5/blacklist/${a.id}`,{headers:{Authorization:`Bearer ${h}`,"x-clerk-token":t}});if(!s.ok)throw new Error("Failed to load blacklist");const n=await s.json();S(n.blacklist||[])}catch(t){console.error("Error loading blacklist:",t),o.error("Failed to load blacklist")}finally{f(!1)}},A=async()=>{if(a){if(!r.company&&!r.domain){o.error("Please provide either a company name or domain");return}try{const t=await m();if(!t){console.error("Failed to get authentication token for adding blacklist entry");return}if(!(await fetch(`https://${p}.supabase.co/functions/v1/make-server-0d5eb2a5/blacklist/${a.id}`,{method:"POST",headers:{Authorization:`Bearer ${h}`,"x-clerk-token":t,"Content-Type":"application/json"},body:JSON.stringify(r)})).ok)throw new Error("Failed to add to blacklist");o.success("Company added to blacklist"),d({company:"",domain:"",reason:""}),g(!1),x()}catch(t){console.error("Error adding to blacklist:",t),o.error("Failed to add to blacklist")}}},B=async t=>{if(a&&confirm("Remove this company from the blacklist?"))try{const s=await m();if(!s){console.error("Failed to get authentication token for removing blacklist entry");return}if(!(await fetch(`https://${p}.supabase.co/functions/v1/make-server-0d5eb2a5/blacklist/${a.id}/${t}`,{method:"DELETE",headers:{Authorization:`Bearer ${h}`,"x-clerk-token":s}})).ok)throw new Error("Failed to remove from blacklist");o.success("Company removed from blacklist"),x()}catch(s){console.error("Error removing from blacklist:",s),o.error("Failed to remove from blacklist")}},$=async t=>{var n;const s=(n=t.target.files)==null?void 0:n[0];if(!(!s||!a)){try{const j=(await s.text()).split(`
`).filter(i=>i.trim()),T=j[0].toLowerCase().includes("company")?1:0,k=j.slice(T).map(i=>{const[L,V,O]=i.split(",").map(z=>z.trim());return{company:L,domain:V,reason:O}}).filter(i=>i.company||i.domain);if(k.length===0){o.error("No valid entries found in CSV");return}const v=await m();if(!v){console.error("Failed to get authentication token for CSV upload"),o.error("Failed to import CSV");return}const y=await fetch(`https://${p}.supabase.co/functions/v1/make-server-0d5eb2a5/blacklist/${a.id}/bulk`,{method:"POST",headers:{Authorization:`Bearer ${h}`,"x-clerk-token":v,"Content-Type":"application/json"},body:JSON.stringify({entries:k})});if(!y.ok)throw new Error("Failed to import CSV");const R=await y.json();o.success(`Imported ${R.count} companies to blacklist`),x()}catch(l){console.error("Error importing CSV:",l),o.error("Failed to import CSV")}u.current&&(u.current.value="")}},F=()=>{const t=`company,domain,reason
Google,google.com,Current client
Meta,meta.com,Competitor`,s=new Blob([t],{type:"text/csv"}),n=URL.createObjectURL(s),l=document.createElement("a");l.href=n,l.download="blacklist-template.csv",l.click(),URL.revokeObjectURL(n)};return C?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Loading blacklist..."})]})}):e.jsxs("div",{className:"p-4 md:p-8 max-w-5xl mx-auto",children:[e.jsxs("div",{className:"mb-6 md:mb-8",children:[e.jsxs("button",{onClick:()=>w(-1),className:"flex items-center gap-2 text-muted-foreground hover:text-foreground transition-colors mb-4",children:[e.jsx(P,{className:"w-4 h-4"}),"Back"]}),e.jsxs("div",{className:"flex flex-col md:flex-row md:items-start md:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"flex items-center gap-3",children:[e.jsx(N,{className:"w-8 h-8 text-destructive"}),"Company Blacklist"]}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Companies that should never be contacted by your team"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsxs("button",{onClick:F,className:"flex items-center justify-center gap-2 px-4 py-2.5 bg-muted rounded-lg hover:bg-muted/80 transition-colors",children:[e.jsx(M,{className:"w-4 h-4"}),"CSV Template"]}),e.jsxs("button",{onClick:()=>{var t;return(t=u.current)==null?void 0:t.click()},className:"flex items-center justify-center gap-2 px-4 py-2.5 bg-secondary text-secondary-foreground rounded-lg hover:bg-secondary/80 transition-colors",children:[e.jsx(G,{className:"w-4 h-4"}),"Import CSV"]}),e.jsx("input",{ref:u,type:"file",accept:".csv",onChange:$,className:"hidden"}),e.jsxs("button",{onClick:()=>g(!0),className:"flex items-center justify-center gap-2 px-4 py-2.5 bg-primary text-primary-foreground rounded-lg hover:bg-primary-hover transition-colors",children:[e.jsx(W,{className:"w-4 h-4"}),"Add Company"]})]})]})]}),e.jsx("div",{className:"glass-card p-4 rounded-xl mb-6 border-l-4 border-yellow-500",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(J,{className:"w-5 h-5 text-yellow-500 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"text-sm",children:[e.jsx("p",{className:"font-semibold mb-1",children:"How Blacklist Works"}),e.jsx("p",{className:"text-muted-foreground",children:"When a team member tries to run a job from a blacklisted company, the automation will be automatically blocked. This prevents wasting credits and protects your relationships."})]})]})}),e.jsxs("div",{className:"glass-card rounded-xl overflow-hidden",children:[e.jsx("div",{className:"p-6 border-b border-border",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("h2",{className:"text-xl font-semibold",children:["Blacklisted Companies (",b.length,")"]})})}),b.length>0?e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"bg-muted/50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-left p-4 font-semibold",children:"Company"}),e.jsx("th",{className:"text-left p-4 font-semibold hidden md:table-cell",children:"Domain"}),e.jsx("th",{className:"text-left p-4 font-semibold hidden md:table-cell",children:"Reason"}),e.jsx("th",{className:"text-left p-4 font-semibold hidden sm:table-cell",children:"Added"}),e.jsx("th",{className:"text-right p-4 font-semibold",children:"Actions"})]})}),e.jsx("tbody",{children:b.map(t=>e.jsxs("tr",{className:"border-b border-border hover:bg-muted/30 transition-colors",children:[e.jsx("td",{className:"p-4",children:e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:t.company||"-"}),t.domain&&e.jsx("p",{className:"text-sm text-muted-foreground md:hidden",children:t.domain}),t.reason&&e.jsx("p",{className:"text-sm text-muted-foreground md:hidden mt-1",children:t.reason})]})}),e.jsx("td",{className:"p-4 text-muted-foreground hidden md:table-cell",children:t.domain||"-"}),e.jsx("td",{className:"p-4 text-muted-foreground hidden md:table-cell",children:t.reason||"-"}),e.jsx("td",{className:"p-4 text-sm text-muted-foreground hidden sm:table-cell",children:new Date(t.addedAt).toLocaleDateString()}),e.jsx("td",{className:"p-4",children:e.jsx("div",{className:"flex items-center justify-end gap-2",children:e.jsx("button",{onClick:()=>B(t.id),className:"p-2 text-destructive hover:bg-destructive/10 rounded-lg transition-colors",title:"Remove from blacklist",children:e.jsx(H,{className:"w-4 h-4"})})})})]},t.id))})]})}):e.jsxs("div",{className:"p-12 text-center text-muted-foreground",children:[e.jsx(N,{className:"w-12 h-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{className:"mb-2",children:"No companies blacklisted yet"}),e.jsx("p",{className:"text-sm",children:"Add companies you don't want your team to contact"})]})]}),E&&e.jsx("div",{className:"fixed inset-0 bg-background/80 backdrop-blur-sm z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"glass-card p-6 rounded-xl max-w-md w-full",children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Add Company to Blacklist"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium mb-2",children:["Company Name ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx("input",{type:"text",value:r.company,onChange:t=>d({...r,company:t.target.value}),placeholder:"e.g., Google",className:"w-full px-4 py-2.5 bg-input-background border border-input rounded-lg focus:outline-none focus:ring-2 focus:ring-ring"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Domain (optional)"}),e.jsx("input",{type:"text",value:r.domain,onChange:t=>d({...r,domain:t.target.value}),placeholder:"e.g., google.com",className:"w-full px-4 py-2.5 bg-input-background border border-input rounded-lg focus:outline-none focus:ring-2 focus:ring-ring"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Reason (optional)"}),e.jsx("textarea",{value:r.reason,onChange:t=>d({...r,reason:t.target.value}),placeholder:"e.g., Current client, Competitor, etc.",rows:3,className:"w-full px-4 py-2.5 bg-input-background border border-input rounded-lg focus:outline-none focus:ring-2 focus:ring-ring resize-none"})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{onClick:A,className:"flex-1 px-4 py-2.5 bg-primary text-primary-foreground rounded-lg hover:bg-primary-hover transition-colors",children:"Add to Blacklist"}),e.jsx("button",{onClick:()=>{g(!1),d({company:"",domain:"",reason:""})},className:"flex-1 px-4 py-2.5 bg-muted rounded-lg hover:bg-muted/80 transition-colors",children:"Cancel"})]})]})})]})}export{Z as Blacklist};
