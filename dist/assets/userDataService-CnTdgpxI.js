import{p as h,b as n}from"./index-EQAU33AY.js";const c=`https://${h}.supabase.co/functions/v1/make-server-0d5eb2a5`,s=new Map,f=3e4;async function d(e,r,a=!1){if(!a){const t=s.get(e);if(t&&Date.now()-t.timestamp<f)return console.log(`üì¶ Using cached data for user ${e}`),t.data}try{const t=await fetch(`${c}/user-data/${e}`,{method:"GET",headers:{Authorization:`Bearer ${n}`,"x-clerk-token":r,"Content-Type":"application/json"}});if(!t.ok)throw new Error(`Failed to fetch user data: ${t.statusText}`);const o=await t.json(),i={contacts:o.contacts||[],tasks:o.tasks||[],jobs:o.jobs||[]};return s.set(e,{data:i,timestamp:Date.now()}),console.log(`‚úÖ Fetched and cached data for user ${e}`),i}catch(t){return console.error("Error fetching user data:",t),{contacts:[],tasks:[],jobs:[]}}}function l(e){s.delete(e),console.log(`üóëÔ∏è Cleared cache for user ${e}`)}async function p(e,r,a){try{const t=await fetch(`${c}/user-data/${e}/contacts`,{method:"PUT",headers:{Authorization:`Bearer ${n}`,"x-clerk-token":r,"Content-Type":"application/json"},body:JSON.stringify({contacts:a})});if(!t.ok){const o=await t.json().catch(()=>({}));throw console.error("‚ùå Server error response:",o),new Error(`Failed to save contacts: ${o.details||o.error||t.statusText}`)}return console.log(`‚úÖ Saved ${a.length} contacts for user ${e}`),l(e),!0}catch(t){return console.error("Error saving user contacts:",t),!1}}async function $(e,r,a){try{const t=await fetch(`${c}/user-data/${e}/tasks`,{method:"PUT",headers:{Authorization:`Bearer ${n}`,"x-clerk-token":r,"Content-Type":"application/json"},body:JSON.stringify({tasks:a})});if(!t.ok)throw new Error(`Failed to save tasks: ${t.statusText}`);return console.log(`‚úÖ Saved ${a.length} tasks for user ${e}`),l(e),!0}catch(t){return console.error("Error saving user tasks:",t),!1}}export{$ as a,d as f,p as s};
