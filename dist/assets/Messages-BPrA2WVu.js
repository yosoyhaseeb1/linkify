import{c as u,ak as Qe,a as We,u as Xe,r as l,j as e,g as Ze,Q as pe,f as fe,U as _e,o as d,al as Ge,am as Ye,V as es,P as ss,X as L,p as g,b}from"./index-EQAU33AY.js";import{P as ge}from"./plus-CsoShjA1.js";import{L as be,B as ts}from"./lock-CR-doHwF.js";import{H as je}from"./hash-BtaA_Wve.js";import{M as Ne}from"./message-circle-DT_C4On-.js";import{E as ns}from"./ellipsis-vertical-3Q3gJHG9.js";import{T as rs}from"./trash-2-DNzLU7cH.js";/**
 * @license lucide-react v0.400.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ye=u("AtSign",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M16 8v5a3 3 0 0 0 6 0v-1a10 10 0 1 0-4 8",key:"7n84p3"}]]);/**
 * @license lucide-react v0.400.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const as=u("BellOff",[["path",{d:"M8.7 3A6 6 0 0 1 18 8a21.3 21.3 0 0 0 .6 5",key:"o7mx20"}],["path",{d:"M17 17H3s3-2 3-9a4.67 4.67 0 0 1 .3-1.7",key:"16f1lm"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.400.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const os=u("Bold",[["path",{d:"M6 12h9a4 4 0 0 1 0 8H7a1 1 0 0 1-1-1V5a1 1 0 0 1 1-1h7a4 4 0 0 1 0 8",key:"mg9rjx"}]]);/**
 * @license lucide-react v0.400.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const is=u("Code",[["polyline",{points:"16 18 22 12 16 6",key:"z7tu5w"}],["polyline",{points:"8 6 2 12 8 18",key:"1eg1df"}]]);/**
 * @license lucide-react v0.400.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ls=u("Italic",[["line",{x1:"19",x2:"10",y1:"4",y2:"4",key:"15jd3p"}],["line",{x1:"14",x2:"5",y1:"20",y2:"20",key:"bu0au3"}],["line",{x1:"15",x2:"9",y1:"4",y2:"20",key:"uljnxc"}]]);/**
 * @license lucide-react v0.400.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cs=u("Paperclip",[["path",{d:"m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l8.57-8.57A4 4 0 1 1 18 8.84l-8.59 8.57a2 2 0 0 1-2.83-2.83l8.49-8.48",key:"1u3ebp"}]]);/**
 * @license lucide-react v0.400.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ds=u("Pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]);/**
 * @license lucide-react v0.400.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=u("Pin",[["path",{d:"M12 17v5",key:"bb1du9"}],["path",{d:"M9 10.76a2 2 0 0 1-1.11 1.79l-1.78.9A2 2 0 0 0 5 15.24V16a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-.76a2 2 0 0 0-1.11-1.79l-1.78-.9A2 2 0 0 1 15 10.76V7a1 1 0 0 1 1-1 2 2 0 0 0 0-4H8a2 2 0 0 0 0 4 1 1 0 0 1 1 1z",key:"1nkz8b"}]]);/**
 * @license lucide-react v0.400.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=u("Reply",[["polyline",{points:"9 17 4 12 9 7",key:"hvgpf2"}],["path",{d:"M20 18v-2a4 4 0 0 0-4-4H4",key:"5vmcpk"}]]);/**
 * @license lucide-react v0.400.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ke=u("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]);/**
 * @license lucide-react v0.400.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const we=u("Smile",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 14s1.5 2 4 2 4-2 4-2",key:"1y1vjs"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]]);/**
 * @license lucide-react v0.400.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ms=u("Volume2",[["polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",key:"16drj5"}],["path",{d:"M15.54 8.46a5 5 0 0 1 0 7.07",key:"ltjumu"}],["path",{d:"M19.07 4.93a10 10 0 0 1 0 14.14",key:"1kegas"}]]),Ce=["ðŸ‘","â¤ï¸","ðŸ˜‚","ðŸŽ‰","ðŸš€","ðŸ‘€","ðŸ”¥","âœ…"];function Ns(){Qe();const{currentOrg:o,members:C}=We(),{user:m,getToken:f}=Xe(),[F,se]=l.useState([]),[i,H]=l.useState(null),[x,N]=l.useState([]),[h,k]=l.useState(""),[us,te]=l.useState(!0),[Me,M]=l.useState(!1),[Se,S]=l.useState(!1),[ne,P]=l.useState(null),[Pe,O]=l.useState(null),[V,$]=l.useState(""),[$e,U]=l.useState(!1),[j,re]=l.useState(null),[Ee,Te]=l.useState([]),[Ae,De]=l.useState(""),[J,Re]=l.useState(!0),[K,ze]=l.useState(!0),[ae,E]=l.useState(!1),[oe,T]=l.useState(!1),[ie,A]=l.useState(!1),[le,D]=l.useState(!1),[ce,y]=l.useState(!1),[R,Ie]=l.useState(!1),z=l.useRef(null),I=l.useRef(null),w=l.useRef(""),q=l.useRef(null),Q=l.useRef(null),W=l.useRef(null),X=l.useRef(null);l.useEffect(()=>()=>{A(!1),D(!1),y(!1),U(!1),S(!1),P(null),E(!1),T(!1)},[]),l.useEffect(()=>{const s=t=>{q.current&&!q.current.contains(t.target)&&P(null),Q.current&&!Q.current.contains(t.target)&&E(!1),W.current&&!W.current.contains(t.target)&&T(!1),X.current&&!X.current.contains(t.target)&&y(!1)};return document.addEventListener("mousedown",s),()=>{document.removeEventListener("mousedown",s)}},[]),l.useEffect(()=>{(async()=>{var t;if(o!=null&&o.id){te(!0);try{const r=await f(),a=await fetch(`https://${g}.supabase.co/functions/v1/make-server-0d5eb2a5/channels/${o.id}`,{headers:{Authorization:`Bearer ${b}`,"x-clerk-token":r}});if(a.ok){const n=await a.json();se(n.channels||[]);const c=(t=n.channels)==null?void 0:t.find(p=>p.name==="general");c&&(H(c),Be(c.id))}}catch(r){console.error("Error loading channels:",r),d.error("Failed to load channels")}finally{te(!1)}}})()},[o==null?void 0:o.id]);const Be=async s=>{if(o!=null&&o.id)try{M(!0);const t=await f(),r=await fetch(`https://${g}.supabase.co/functions/v1/make-server-0d5eb2a5/messages/${o.id}/${s}`,{headers:{Authorization:`Bearer ${b}`,"x-clerk-token":t}});if(r.ok){const n=(await r.json()).messages||[],c=JSON.stringify(n);c!==w.current&&(w.current=c,N(n),setTimeout(()=>Z(),100))}}catch(t){console.error("Error loading messages:",t)}finally{M(!1)}};l.useEffect(()=>{const s=async()=>{if(!(!(o!=null&&o.id)||!(i!=null&&i.id)))try{const r=await f(),a=await fetch(`https://${g}.supabase.co/functions/v1/make-server-0d5eb2a5/messages/${o.id}/${i.id}`,{headers:{Authorization:`Bearer ${b}`,"x-clerk-token":r}});if(a.ok){const c=(await a.json()).messages||[],p=JSON.stringify(c);if(p!==w.current&&(w.current=p,N(c),z.current)){const v=z.current.parentElement;(v&&v.scrollHeight-v.scrollTop-v.clientHeight<100||c.length===1)&&Z()}}}catch(r){console.error("Error loading messages:",r)}finally{M(!1)}};i&&x.length===0&&(M(!0),s());const t=setInterval(s,1e4);return()=>{clearInterval(t),w.current=""}},[o==null?void 0:o.id,i==null?void 0:i.id]);const Z=()=>{setTimeout(()=>{var s;(s=z.current)==null||s.scrollIntoView({behavior:"smooth"})},100)},de=async()=>{if(!h.trim()||!i||!m||!o)return;const s=h.trim();k("");try{const t=await f(),r=await fetch(`https://${g}.supabase.co/functions/v1/make-server-0d5eb2a5/messages/${o.id}/${i.id}`,{method:"POST",headers:{Authorization:`Bearer ${b}`,"x-clerk-token":t,"Content-Type":"application/json"},body:JSON.stringify({content:s,userId:m.id,userName:m.name,userAvatar:m.avatar,mentions:Le(s),parentMessageId:(j==null?void 0:j.id)||null})});if(r.ok){const a=await r.json();N([...x,a.message]),Z()}else d.error("Failed to send message")}catch(t){console.error("Error sending message:",t),d.error("Failed to send message")}},Le=s=>{const t=/@(\w+)/g,r=[];let a;for(;(a=t.exec(s))!==null;)r.push(a[1]);return r},me=async(s,t)=>{if(!(!o||!i))try{const r=await f(),a=await fetch(`https://${g}.supabase.co/functions/v1/make-server-0d5eb2a5/messages/${o.id}/${i.id}/${s}`,{method:"PATCH",headers:{Authorization:`Bearer ${b}`,"x-clerk-token":r,"Content-Type":"application/json"},body:JSON.stringify({content:t})});if(a.ok){const n=await a.json();N(x.map(c=>c.id===s?n.message:c)),O(null),$(""),d.success("Message updated")}}catch(r){console.error("Error editing message:",r),d.error("Failed to edit message")}},Fe=async s=>{if(!(!o||!i))try{const t=await f();(await fetch(`https://${g}.supabase.co/functions/v1/make-server-0d5eb2a5/messages/${o.id}/${i.id}/${s}`,{method:"DELETE",headers:{Authorization:`Bearer ${b}`,"x-clerk-token":t}})).ok&&(N(x.filter(a=>a.id!==s)),d.success("Message deleted"))}catch(t){console.error("Error deleting message:",t),d.error("Failed to delete message")}},ue=async(s,t)=>{if(!(!o||!i||!m))try{const r=await f(),a=await fetch(`https://${g}.supabase.co/functions/v1/make-server-0d5eb2a5/messages/${o.id}/${i.id}/${s}/reactions`,{method:"POST",headers:{Authorization:`Bearer ${b}`,"x-clerk-token":r,"Content-Type":"application/json"},body:JSON.stringify({emoji:t,userId:m.id})});if(a.ok){const n=await a.json();N(x.map(c=>c.id===s?n.message:c)),P(null)}}catch(r){console.error("Error adding reaction:",r)}},xe=async s=>{if(re(s),U(!0),!!o)try{const t=await f(),r=await fetch(`https://${g}.supabase.co/functions/v1/make-server-0d5eb2a5/messages/${o.id}/${s.channelId}/${s.id}/thread`,{headers:{Authorization:`Bearer ${b}`,"x-clerk-token":t}});if(r.ok){const a=await r.json();Te(a.messages||[])}}catch(t){console.error("Error loading thread:",t)}},He=async(s,t,r)=>{if(!(!o||!m))try{const a=await f(),n=await fetch(`https://${g}.supabase.co/functions/v1/make-server-0d5eb2a5/channels/${o.id}`,{method:"POST",headers:{Authorization:`Bearer ${b}`,"x-clerk-token":a,"Content-Type":"application/json"},body:JSON.stringify({name:s,description:t,isPrivate:r,createdBy:m.id})});if(n.ok){const c=await n.json();se([...F,c.channel]),S(!1),d.success(`Channel #${s} created!`)}}catch(a){console.error("Error creating channel:",a),d.error("Failed to create channel")}},B=s=>{const t=new Date(s);return(new Date().getTime()-t.getTime())/(1e3*60*60)<24?t.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"}):t.toLocaleDateString("en-US",{month:"short",day:"numeric"})},_=s=>{const t=I.current;if(!t)return;const r=t.selectionStart,a=t.selectionEnd,n=h.substring(r,a);let c="",p=0;switch(s){case"bold":c=n?`**${n}**`:"****",p=n?n.length+4:2;break;case"italic":c=n?`*${n}*`:"**",p=n?n.length+2:1;break;case"code":c=n?`\`${n}\``:"``",p=n?n.length+2:1;break}const v=h.substring(0,r)+c+h.substring(a);k(v),setTimeout(()=>{t.focus();const Y=r+p;t.setSelectionRange(Y,Y)},0),console.log(`Applied ${s} formatting`)},Oe=()=>{T(!oe),console.log("Mention dropdown toggled")},Ve=s=>{const t=I.current;if(!t)return;const r=t.selectionStart,a=`@${s} `,n=h.substring(0,r)+a+h.substring(r);k(n),T(!1),setTimeout(()=>{t.focus();const c=r+a.length;t.setSelectionRange(c,c)},0)},Ue=s=>{const t=I.current;if(!t)return;const r=t.selectionStart,a=h.substring(0,r)+s+h.substring(r);k(a),E(!1),setTimeout(()=>{t.focus();const n=r+s.length;t.setSelectionRange(n,n)},0),console.log("Inserted emoji:",s)},Je=()=>{const s=document.createElement("input");s.type="file",s.multiple=!0,s.accept="image/*,.pdf,.doc,.docx,.txt",s.onchange=t=>{const r=t.target.files;r&&r.length>0&&(console.log("Files selected:",Array.from(r).map(a=>a.name)),d.success(`${r.length} file(s) selected (upload feature coming soon)`))},s.click()},he=s=>{const t=x.find(a=>a.id===s);if(!t)return;const r=!t.isPinned;N(x.map(a=>a.id===s?{...a,isPinned:r}:a)),d.success(r?"Message pinned!":"Message unpinned")},G=x.filter(s=>s.isPinned),Ke=F.filter(s=>s.type==="channel"),qe=F.filter(s=>s.type==="dm");return e.jsxs("div",{className:"flex h-screen max-h-screen overflow-hidden bg-background",children:[e.jsxs("div",{className:"w-64 border-r border-border bg-muted/20 flex flex-col max-h-screen",children:[e.jsxs("div",{className:"p-4 border-b border-border flex-shrink-0",children:[e.jsx("h2",{className:"text-lg font-bold mb-1",children:o==null?void 0:o.name}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[C.length," members"]})]}),e.jsx("div",{className:"p-3 flex-shrink-0",children:e.jsxs("div",{className:"relative",children:[e.jsx(Ze,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx("input",{type:"text",placeholder:"Search messages...",value:Ae,onChange:s=>De(s.target.value),className:"w-full pl-9 pr-3 py-2 bg-background border border-border rounded-lg text-sm"})]})}),e.jsxs("div",{className:"flex-1 overflow-y-auto min-h-0",children:[e.jsxs("div",{className:"px-2",children:[e.jsxs("div",{className:"w-full flex items-center justify-between px-2 py-1 hover:bg-muted/50 rounded transition-colors",children:[e.jsxs("button",{onClick:()=>Re(!J),className:"flex items-center gap-1 flex-1",children:[J?e.jsx(pe,{className:"w-4 h-4"}):e.jsx(fe,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Channels"})]}),e.jsx("button",{onClick:s=>{s.stopPropagation(),S(!0)},className:"p-0.5 hover:bg-muted rounded",children:e.jsx(ge,{className:"w-4 h-4"})})]}),J&&e.jsx("div",{className:"mt-1",children:Ke.map(s=>e.jsxs("button",{onClick:()=>H(s),className:`w-full flex items-center gap-2 px-2 py-1.5 rounded transition-colors text-sm ${(i==null?void 0:i.id)===s.id?"bg-primary text-primary-foreground":"hover:bg-muted/50"}`,children:[s.isPrivate?e.jsx(be,{className:"w-4 h-4"}):e.jsx(je,{className:"w-4 h-4"}),e.jsx("span",{className:"flex-1 text-left truncate",children:s.name}),s.unreadCount&&s.unreadCount>0&&e.jsx("span",{className:"px-1.5 py-0.5 bg-destructive text-destructive-foreground rounded-full text-xs font-medium",children:s.unreadCount})]},s.id))})]}),e.jsxs("div",{className:"px-2 mt-4",children:[e.jsxs("div",{className:"w-full flex items-center justify-between px-2 py-1 hover:bg-muted/50 rounded transition-colors",children:[e.jsxs("button",{onClick:()=>ze(!K),className:"flex items-center gap-1 flex-1",children:[K?e.jsx(pe,{className:"w-4 h-4"}):e.jsx(fe,{className:"w-4 h-4"}),e.jsx("span",{className:"text-sm font-medium",children:"Direct Messages"})]}),e.jsx("button",{className:"p-0.5 hover:bg-muted rounded",children:e.jsx(ge,{className:"w-4 h-4"})})]}),K&&e.jsx("div",{className:"mt-1",children:qe.map(s=>{var t;return e.jsxs("button",{onClick:()=>H(s),className:`w-full flex items-center gap-2 px-2 py-1.5 rounded transition-colors text-sm ${(i==null?void 0:i.id)===s.id?"bg-primary text-primary-foreground":"hover:bg-muted/50"}`,children:[e.jsx(Ne,{className:"w-4 h-4"}),e.jsx("span",{className:"flex-1 text-left truncate",children:(t=s.participants)==null?void 0:t.map(r=>r.name).join(", ")}),s.unreadCount&&s.unreadCount>0&&e.jsx("span",{className:"px-1.5 py-0.5 bg-destructive text-destructive-foreground rounded-full text-xs font-medium",children:s.unreadCount})]},s.id)})})]})]})]}),e.jsxs("div",{className:"flex-1 flex flex-col min-w-0 max-h-screen",children:[i&&e.jsxs("div",{className:"h-14 border-b border-border px-4 flex items-center justify-between bg-background flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-0",children:[i.type==="channel"?i.isPrivate?e.jsx(be,{className:"w-5 h-5 flex-shrink-0"}):e.jsx(je,{className:"w-5 h-5 flex-shrink-0"}):e.jsx(Ne,{className:"w-5 h-5 flex-shrink-0"}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h3",{className:"font-semibold truncate",children:i.name}),i.description&&e.jsx("p",{className:"text-xs text-muted-foreground truncate",children:i.description})]})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-shrink-0",children:[e.jsx("button",{type:"button",onClick:s=>{s.stopPropagation(),A(!ie)},className:"p-2 hover:bg-muted rounded-lg transition-colors",title:"View members","aria-label":"View members",children:e.jsx(_e,{className:"w-5 h-5"})}),e.jsx("button",{type:"button",onClick:s=>{s.stopPropagation(),D(!le)},className:"p-2 hover:bg-muted rounded-lg transition-colors",title:"Pinned messages","aria-label":"Pinned messages",children:e.jsx(ee,{className:"w-5 h-5"})}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{type:"button",onClick:s=>{s.stopPropagation(),y(!ce)},className:"p-2 hover:bg-muted rounded-lg transition-colors",title:"More options","aria-label":"More options",children:e.jsx(ns,{className:"w-5 h-5"})}),ce&&e.jsxs("div",{ref:X,className:"absolute right-0 top-10 p-2 bg-popover border border-border rounded-lg shadow-lg z-50 flex flex-col max-h-40 overflow-y-auto min-w-[200px]",children:[e.jsxs("button",{onClick:()=>{Ie(!R),y(!1),d.success(R?"Channel unmuted":"Channel muted")},className:"flex items-center gap-2 px-2 py-1.5 rounded transition-colors text-sm hover:bg-muted/50 text-left",type:"button",children:[R?e.jsx(as,{className:"w-4 h-4"}):e.jsx(ts,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:R?"Unmute channel":"Mute channel"})]}),e.jsxs("button",{onClick:()=>{y(!1),d.info("Leave channel feature coming soon")},className:"flex items-center gap-2 px-2 py-1.5 rounded transition-colors text-sm hover:bg-muted/50 text-left",type:"button",children:[e.jsx(Ge,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:"Leave channel"})]}),e.jsxs("button",{onClick:()=>{y(!1),d.info("Channel settings coming soon")},className:"flex items-center gap-2 px-2 py-1.5 rounded transition-colors text-sm hover:bg-muted/50 text-left",type:"button",children:[e.jsx(Ye,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:"Channel settings"})]}),e.jsxs("button",{onClick:()=>{y(!1),d.info("Notification settings coming soon")},className:"flex items-center gap-2 px-2 py-1.5 rounded transition-colors text-sm hover:bg-muted/50 text-left",type:"button",children:[e.jsx(ms,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:"Notification settings"})]})]})]})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto min-h-0 p-4 space-y-4 relative",children:[e.jsx(es,{}),Me?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})}):x.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center",children:[e.jsx(ss,{className:"w-12 h-12 text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"No messages yet"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Be the first to send a message in #",i==null?void 0:i.name]})]}):x.map((s,t)=>{const r=s.userId===(m==null?void 0:m.id),a=t===0||x[t-1].userId!==s.userId;return e.jsxs("div",{className:`group flex gap-3 ${a?"mt-4":"mt-1"}`,children:[a?e.jsx("div",{className:"w-10 h-10 rounded-full bg-primary flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-sm font-medium text-primary-foreground",children:s.userName.charAt(0)})}):e.jsx("div",{className:"w-10 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[a&&e.jsxs("div",{className:"flex items-baseline gap-2 mb-1",children:[e.jsx("span",{className:"font-semibold",children:s.userName}),e.jsx("span",{className:"text-xs text-muted-foreground",children:B(s.timestamp)}),s.edited&&e.jsx("span",{className:"text-xs text-muted-foreground italic",children:"(edited)"})]}),Pe===s.id?e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:V,onChange:n=>$(n.target.value),className:"flex-1 px-3 py-2 bg-background border border-border rounded-lg text-sm",onKeyPress:n=>{n.key==="Enter"&&me(s.id,V)}}),e.jsx("button",{onClick:()=>me(s.id,V),className:"px-3 py-2 bg-primary text-primary-foreground rounded-lg text-sm",children:"Save"}),e.jsx("button",{onClick:()=>{O(null),$("")},className:"px-3 py-2 bg-muted rounded-lg text-sm",children:"Cancel"})]}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-sm break-words",children:s.content}),s.reactions&&s.reactions.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1 mt-1",children:s.reactions.map((n,c)=>e.jsxs("button",{onClick:()=>ue(s.id,n.emoji),className:`flex items-center gap-1 px-2 py-0.5 rounded-full text-xs border ${n.users.includes((m==null?void 0:m.id)||"")?"bg-primary/10 border-primary":"bg-muted border-border hover:border-primary/50"} transition-colors`,children:[e.jsx("span",{children:n.emoji}),e.jsx("span",{children:n.count})]},c))}),(s.threadCount??0)>0&&e.jsxs("button",{onClick:()=>xe(s),className:"flex items-center gap-1 mt-1 text-xs text-primary hover:underline",children:[e.jsx(ve,{className:"w-3 h-3"}),s.threadCount," ",s.threadCount===1?"reply":"replies"]})]})]}),e.jsxs("div",{className:"flex items-start gap-1 transition-opacity flex-shrink-0 group-hover:opacity-100",style:{opacity:.01},children:[e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:n=>{n.preventDefault(),n.stopPropagation(),console.log("Emoji button clicked for message:",s.id),P(ne===s.id?null:s.id)},className:"p-1 hover:bg-muted rounded transition-colors cursor-pointer",type:"button",style:{pointerEvents:"auto"},children:e.jsx(we,{className:"w-4 h-4 pointer-events-none"})}),ne===s.id&&e.jsx("div",{ref:q,className:"absolute right-0 mt-1 p-2 bg-popover border border-border rounded-lg shadow-lg z-50 flex gap-1",onClick:n=>n.stopPropagation(),children:Ce.map(n=>e.jsx("button",{onClick:c=>{c.preventDefault(),c.stopPropagation(),console.log("Adding reaction:",n,"to message:",s.id),ue(s.id,n)},className:"text-lg hover:scale-125 transition-transform cursor-pointer",type:"button",style:{pointerEvents:"auto"},children:n},n))})]}),e.jsx("button",{onClick:n=>{n.preventDefault(),n.stopPropagation(),console.log("Thread button clicked for message:",s.id),xe(s)},className:"p-1 hover:bg-muted rounded transition-colors cursor-pointer",type:"button",style:{pointerEvents:"auto"},children:e.jsx(ve,{className:"w-4 h-4 pointer-events-none"})}),e.jsx("button",{onClick:n=>{n.preventDefault(),n.stopPropagation(),he(s.id)},className:`p-1 hover:bg-muted rounded transition-colors cursor-pointer ${s.isPinned?"text-primary":""}`,type:"button",style:{pointerEvents:"auto"},title:s.isPinned?"Unpin message":"Pin message",children:e.jsx(ee,{className:"w-4 h-4 pointer-events-none"})}),r&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:n=>{n.preventDefault(),n.stopPropagation(),console.log("Edit button clicked for message:",s.id),O(s.id),$(s.content)},className:"p-1 hover:bg-muted rounded transition-colors cursor-pointer",type:"button",style:{pointerEvents:"auto"},children:e.jsx(ds,{className:"w-4 h-4 pointer-events-none"})}),e.jsx("button",{onClick:n=>{n.preventDefault(),n.stopPropagation(),console.log("Delete button clicked for message:",s.id),confirm("Delete this message?")&&Fe(s.id)},className:"p-1 hover:bg-destructive/10 rounded transition-colors text-destructive cursor-pointer",type:"button",style:{pointerEvents:"auto"},children:e.jsx(rs,{className:"w-4 h-4 pointer-events-none"})})]})]})]},s.id)}),e.jsx("div",{ref:z})]}),i&&e.jsxs("div",{className:"p-4 border-t border-border bg-background flex-shrink-0",children:[e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsxs("div",{className:"flex-1 relative",children:[e.jsx("textarea",{ref:I,value:h,onChange:s=>k(s.target.value),onKeyPress:s=>{s.key==="Enter"&&!s.shiftKey&&(s.preventDefault(),de())},placeholder:`Message #${i.name}`,className:"w-full px-4 py-3 pr-12 bg-background border border-border rounded-lg resize-none focus:outline-none focus:ring-2 focus:ring-primary",rows:1,style:{minHeight:"44px",maxHeight:"120px"}}),e.jsxs("div",{className:"absolute right-2 bottom-2 flex items-center gap-1",children:[e.jsx("button",{className:"p-1.5 hover:bg-muted rounded transition-colors",onClick:()=>_("bold"),type:"button",title:"Bold (Ctrl+B)",children:e.jsx(os,{className:"w-4 h-4"})}),e.jsx("button",{className:"p-1.5 hover:bg-muted rounded transition-colors",onClick:()=>_("italic"),type:"button",title:"Italic (Ctrl+I)",children:e.jsx(ls,{className:"w-4 h-4"})}),e.jsx("button",{className:"p-1.5 hover:bg-muted rounded transition-colors",onClick:()=>_("code"),type:"button",title:"Code",children:e.jsx(is,{className:"w-4 h-4"})}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{className:"p-1.5 hover:bg-muted rounded transition-colors",onClick:Oe,type:"button",title:"Mention team member",children:e.jsx(ye,{className:"w-4 h-4"})}),oe&&e.jsx("div",{ref:W,className:"absolute right-0 bottom-10 p-2 bg-popover border border-border rounded-lg shadow-lg z-50 flex flex-col max-h-40 overflow-y-auto min-w-[200px]",children:C.map(s=>e.jsxs("button",{onClick:()=>Ve(s.name),className:"flex items-center gap-2 px-2 py-1.5 rounded transition-colors text-sm hover:bg-muted/50 text-left",type:"button",children:[e.jsx(ye,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:s.name})]},s.id))})]}),e.jsxs("div",{className:"relative",children:[e.jsx("button",{className:"p-1.5 hover:bg-muted rounded transition-colors",onClick:()=>E(!ae),type:"button",title:"Insert emoji",children:e.jsx(we,{className:"w-4 h-4"})}),ae&&e.jsx("div",{ref:Q,className:"absolute right-0 bottom-10 p-2 bg-popover border border-border rounded-lg shadow-lg z-50 flex gap-1",children:Ce.map(s=>e.jsx("button",{onClick:t=>{t.preventDefault(),t.stopPropagation(),console.log("Inserting emoji:",s),Ue(s)},className:"text-lg hover:scale-125 transition-transform cursor-pointer",type:"button",style:{pointerEvents:"auto"},children:s},s))})]}),e.jsx("button",{className:"p-1.5 hover:bg-muted rounded transition-colors",onClick:Je,type:"button",title:"Attach file",children:e.jsx(cs,{className:"w-4 h-4"})})]})]}),e.jsx("button",{onClick:de,disabled:!h.trim(),className:"p-3 bg-primary text-primary-foreground rounded-lg hover:bg-primary-hover transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex-shrink-0",children:e.jsx(ke,{className:"w-5 h-5"})})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:"Press Enter to send, Shift + Enter for new line"})]})]}),$e&&j&&e.jsxs("div",{className:"w-96 border-l border-border bg-background flex flex-col max-h-screen",children:[e.jsxs("div",{className:"h-14 border-b border-border px-4 flex items-center justify-between flex-shrink-0",children:[e.jsx("h3",{className:"font-semibold",children:"Thread"}),e.jsx("button",{onClick:()=>{U(!1),re(null)},className:"p-1 hover:bg-muted rounded transition-colors",children:e.jsx(L,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"p-4 border-b border-border flex-shrink-0",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-primary flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-sm font-medium text-primary-foreground",children:j.userName.charAt(0)})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-baseline gap-2 mb-1",children:[e.jsx("span",{className:"font-semibold truncate",children:j.userName}),e.jsx("span",{className:"text-xs text-muted-foreground flex-shrink-0",children:B(j.timestamp)})]}),e.jsx("p",{className:"text-sm break-words",children:j.content})]})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto min-h-0 p-4 space-y-3",children:Ee.map(s=>e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-primary flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-xs font-medium text-primary-foreground",children:s.userName.charAt(0)})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-baseline gap-2 mb-1",children:[e.jsx("span",{className:"font-medium text-sm truncate",children:s.userName}),e.jsx("span",{className:"text-xs text-muted-foreground flex-shrink-0",children:B(s.timestamp)})]}),e.jsx("p",{className:"text-sm break-words",children:s.content})]})]},s.id))}),e.jsx("div",{className:"p-4 border-t border-border flex-shrink-0",children:e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsx("input",{type:"text",placeholder:"Reply to thread...",className:"flex-1 px-3 py-2 bg-background border border-border rounded-lg text-sm",onKeyPress:s=>{s.key==="Enter"&&s.currentTarget.value.trim()&&(s.currentTarget.value="")}}),e.jsx("button",{className:"p-2 bg-primary text-primary-foreground rounded-lg hover:bg-primary-hover transition-colors flex-shrink-0",children:e.jsx(ke,{className:"w-4 h-4"})})]})})]}),Se&&e.jsx("div",{className:"fixed inset-0 bg-background/80 backdrop-blur-sm flex items-center justify-center z-50",children:e.jsxs("div",{className:"glass-card p-6 rounded-xl w-full max-w-md",children:[e.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Create Channel"}),e.jsxs("form",{onSubmit:s=>{s.preventDefault();const t=new FormData(s.currentTarget);He(t.get("name"),t.get("description"),t.get("isPrivate")==="on")},children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Channel Name"}),e.jsx("input",{type:"text",name:"name",required:!0,className:"w-full px-3 py-2 bg-background border border-border rounded-lg",placeholder:"e.g., marketing-team"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-1",children:"Description (Optional)"}),e.jsx("textarea",{name:"description",className:"w-full px-3 py-2 bg-background border border-border rounded-lg resize-none",rows:2,placeholder:"What's this channel about?"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"checkbox",name:"isPrivate",id:"isPrivate",className:"rounded"}),e.jsx("label",{htmlFor:"isPrivate",className:"text-sm",children:"Make private (only visible to invited members)"})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{type:"button",onClick:()=>S(!1),className:"flex-1 px-4 py-2 bg-muted rounded-lg hover:bg-muted/80 transition-colors",children:"Cancel"}),e.jsx("button",{type:"submit",className:"flex-1 px-4 py-2 bg-primary text-primary-foreground rounded-lg hover:bg-primary-hover transition-colors",children:"Create Channel"})]})]})]})}),ie&&e.jsx("div",{className:"fixed inset-0 bg-background/80 backdrop-blur-sm flex items-end justify-end z-50",onClick:s=>{s.target===s.currentTarget&&A(!1)},children:e.jsxs("div",{className:"w-80 h-full bg-background border-l border-border flex flex-col",children:[e.jsxs("div",{className:"h-14 border-b border-border px-4 flex items-center justify-between flex-shrink-0",children:[e.jsxs("h3",{className:"font-semibold",children:["Members (",C.length,")"]}),e.jsx("button",{onClick:()=>A(!1),className:"p-1 hover:bg-muted rounded transition-colors",children:e.jsx(L,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-3",children:C.map(s=>e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-primary flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-sm font-medium text-primary-foreground",children:s.name.charAt(0)})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium truncate",children:s.name}),e.jsx("p",{className:"text-xs text-muted-foreground truncate",children:s.role})]}),e.jsx("div",{className:"w-2 h-2 rounded-full bg-green-500 flex-shrink-0",title:"Online"})]},s.id))})]})}),le&&e.jsx("div",{className:"fixed inset-0 bg-background/80 backdrop-blur-sm flex items-end justify-end z-50",onClick:s=>{s.target===s.currentTarget&&D(!1)},children:e.jsxs("div",{className:"w-80 h-full bg-background border-l border-border flex flex-col",children:[e.jsxs("div",{className:"h-14 border-b border-border px-4 flex items-center justify-between flex-shrink-0",children:[e.jsxs("h3",{className:"font-semibold",children:["Pinned Messages (",G.length,")"]}),e.jsx("button",{onClick:()=>D(!1),className:"p-1 hover:bg-muted rounded transition-colors",children:e.jsx(L,{className:"w-5 h-5"})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:G.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center",children:[e.jsx(ee,{className:"w-12 h-12 text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"No pinned messages"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Pin important messages to find them easily later"})]}):G.map(s=>e.jsx("div",{className:"p-3 bg-muted/30 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2 mb-2",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-primary flex items-center justify-center flex-shrink-0",children:e.jsx("span",{className:"text-xs font-medium text-primary-foreground",children:s.userName.charAt(0)})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-baseline gap-2 mb-1",children:[e.jsx("span",{className:"text-sm font-semibold truncate",children:s.userName}),e.jsx("span",{className:"text-xs text-muted-foreground flex-shrink-0",children:B(s.timestamp)})]}),e.jsx("p",{className:"text-sm break-words",children:s.content})]}),e.jsx("button",{onClick:()=>he(s.id),className:"p-1 hover:bg-muted rounded transition-colors text-primary",title:"Unpin message",children:e.jsx(L,{className:"w-4 h-4"})})]})},s.id))})]})})]})}export{Ns as Messages};
