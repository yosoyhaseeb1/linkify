import{r as p,k as P,a as S,j as e,n as J,X as $,h as A,M as I,o as d,p as D,b as O,U as _}from"./index-EQAU33AY.js";import{P as T}from"./plus-CsoShjA1.js";function W(){const[a,j]=p.useState([""]),[v,y]=p.useState("50"),[b,m]=p.useState(!1),[z,B]=p.useState(!1),[o,c]=p.useState([]),h=P(),{currentOrg:w}=S(),g=s=>s.trim()?s.includes("/jobs/search/")||s.includes("?keywords=")?"Job search URLs are not supported. Please provide a single job post URL or job description.":"":"Please provide a LinkedIn job post URL or job description",k=()=>{j([...a,""]),c([...o,""])},R=s=>{const r=a.filter((t,l)=>l!==s),i=o.filter((t,l)=>l!==s);j(r.length>0?r:[""]),c(i.length>0?i:[""])},L=(s,r)=>{const i=[...a];i[s]=r,j(i);const t=[...o];t[s]="",c(t)},C=s=>{const r=[...o];r[s]=g(a[s]),c(r)},U=async s=>{if(s.preventDefault(),!w){d.error("Organization information not available");return}const r=a.map(t=>g(t));if(r.some(t=>t!=="")){c(r);return}c([]),m(!0);try{const t=a.filter(l=>l.trim());for(const l of t){const u=await fetch(`https://${D}.supabase.co/functions/v1/make-server-0d5eb2a5/runs/create`,{method:"POST",headers:{Authorization:`Bearer ${O}`,"Content-Type":"application/json"},body:JSON.stringify({jobUrl:l,jobTitle:null,company:null})}),n=await u.json();if(u.status===409&&n.error==="duplicate_job_url"){m(!1);const x=n.existingRun,f=new Date(x.createdAt).toLocaleDateString(),E=a.indexOf(l),N=[...o];N[E]=`This job was already run by ${x.userName} on ${f}`,c(N),d.error(e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"font-semibold flex items-center gap-2",children:[e.jsx(_,{className:"w-4 h-4"}),"Duplicate Job Detected"]}),e.jsxs("div",{className:"text-sm",children:[e.jsx("strong",{children:x.userName})," already ran this job on ",f]}),e.jsx("button",{onClick:()=>h(`/runs/${x.id}`),className:"text-xs underline hover:no-underline",children:"View their run â†’"})]}));return}else if(u.status===403&&n.error==="warmup_limit"){m(!1),d.error(e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"font-semibold",children:"ðŸ”¥ Warmup Limit Reached"}),e.jsx("div",{className:"text-sm opacity-80",children:n.message}),e.jsxs("div",{className:"text-xs mt-1 opacity-60",children:["Tomorrow's limit: ",n.tomorrowLimit," runs"]})]}),{duration:6e3});return}else if(u.status===403&&n.error==="usage_limit_exceeded"){m(!1),d.error(n.message,{duration:5e3});return}else if(!u.ok)throw new Error(n.error||"Failed to create run");console.log(`Run created: ${n.runId}`)}d.success(`Run${t.length>1?"s":""} started successfully for ${t.length} job post${t.length>1?"s":""}!`),h("/runs")}catch(t){console.error("Error creating run:",t),d.error("Failed to start run. Please try again.")}finally{m(!1)}};return e.jsxs("div",{className:"p-8 max-w-4xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("button",{onClick:()=>h(-1),className:"flex items-center gap-2 text-muted-foreground hover:text-foreground transition-colors mb-4",children:[e.jsx(J,{className:"w-4 h-4"}),"Back"]}),e.jsx("h1",{children:"New Automation Run"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Paste a LinkedIn job post URL or job description to find decision makers"})]}),e.jsxs("form",{onSubmit:U,className:"glass-card p-8 rounded-xl space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block mb-3",children:"LinkedIn Job Post URLs"}),e.jsx("div",{className:"space-y-3",children:a.map((s,r)=>e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"text",value:s,onChange:i=>L(r,i.target.value),onBlur:()=>C(r),placeholder:"https://www.linkedin.com/jobs/view/12345...",className:`flex-1 px-4 py-2.5 bg-input-background border rounded-lg focus:outline-none focus:ring-2 focus:ring-ring ${o[r]?"border-destructive":"border-input"}`}),a.length>1&&e.jsx("button",{type:"button",onClick:()=>R(r),className:"p-2 text-muted-foreground hover:text-destructive transition-colors",children:e.jsx($,{className:"w-5 h-5"})}),r===a.length-1&&e.jsx("button",{type:"button",onClick:k,className:"p-2 text-muted-foreground hover:text-primary transition-colors",children:e.jsx(T,{className:"w-5 h-5"})})]}),o[r]&&e.jsxs("div",{className:"flex items-center gap-2 text-destructive text-sm mt-2",children:[e.jsx(A,{className:"w-4 h-4 flex-shrink-0"}),e.jsx("span",{children:o[r]})]})]},r))}),e.jsx("p",{className:"text-sm text-muted-foreground mt-3",children:"Add multiple LinkedIn job post URLs to run automation for each"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"max-prospects",className:"block mb-2",children:"Maximum Prospects (Optional)"}),e.jsxs("select",{id:"max-prospects",value:v,onChange:s=>y(s.target.value),className:"w-full px-4 py-3 bg-input-background border border-input rounded-lg focus:outline-none focus:ring-2 focus:ring-ring",children:[e.jsx("option",{value:"25",children:"25 prospects"}),e.jsx("option",{value:"50",children:"50 prospects"}),e.jsx("option",{value:"100",children:"100 prospects"}),e.jsx("option",{value:"200",children:"200 prospects"})]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Limit the number of prospects to find for this run"})]}),e.jsxs("div",{className:"pt-4 border-t border-border",children:[e.jsx("h3",{className:"mb-2",children:"What happens next?"}),e.jsxs("ul",{className:"space-y-2 text-sm text-muted-foreground",children:[e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-primary mt-0.5",children:"1."}),e.jsx("span",{children:"We'll analyze the job posting and identify the right decision makers"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-primary mt-0.5",children:"2."}),e.jsx("span",{children:"Draft personalized connection messages for each prospect"})]}),e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"text-primary mt-0.5",children:"3."}),e.jsx("span",{children:"Create a campaign in HeyReach (paused by default)"})]})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-4",children:"Estimated time: 2-3 minutes"})]}),e.jsxs("div",{className:"flex items-center gap-4 pt-4",children:[e.jsxs("button",{type:"submit",disabled:b||a.every(s=>!s.trim()),className:"flex items-center gap-2 px-8 py-3 bg-primary text-primary-foreground rounded-lg font-medium transition-all duration-200 hover:bg-primary-hover hover:scale-[1.02] disabled:opacity-50 disabled:cursor-not-allowed",children:[b&&e.jsx(I,{className:"w-4 h-4 animate-spin"}),b?"Starting Run...":"Run Automation"]}),e.jsx("button",{type:"button",onClick:()=>h(-1),className:"px-8 py-3 bg-secondary text-secondary-foreground rounded-lg hover:bg-secondary/80 transition-colors",children:"Cancel"})]})]})]})}export{W as NewRun};
